!function(e){"use strict";(window.PopIn||{}).define("Common",{})}(),function(e,i){"use strict";var t,n=function(e){return"object"==typeof e&&"function"==typeof e.getItem&&"function"==typeof e.setItem&&"function"==typeof e.removeItem},r=function(){return null},o={STORAGE_NAME_MAP:{local:"localStorage",session:"sessionStorage"}},s={get:function(e,t){return i[this.STORAGE_NAME_MAP[e]].getItem(t)},set:function(e,t,n){return i[this.STORAGE_NAME_MAP[e]].setItem(t,n)},remove:function(e,t){return i[this.STORAGE_NAME_MAP[e]].removeItem(t)}};try{t=n(i.sessionStorage)&&n(i.localStorage)}catch(e){t=!1}for(var a in s)o[a]=!0===t?s[a]:r;e.define("Common.Storage",o)}(window.PopIn,window),function(e,t){"use strict";function s(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var i in n)e[i]=n[i]}return e}function c(e){return e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)}e.define("Common.Cookie",function e(a){function n(e,t,n){if("undefined"!=typeof document){"number"==typeof(n=s(o.defaults,n)).expires&&(n.expires=new Date(Date.now()+864e5*n.expires)),n.expires&&(n.expires=n.expires.toUTCString()),t=a.write?a.write(t,e):encodeURIComponent(String(t)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var i="";for(var r in n)n[r]&&(i+="; "+r,!0!==n[r]&&(i+="="+n[r].split(";")[0]));return document.cookie=e+"="+t+i}}var o={defaults:{path:"/"},set:n,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var t=document.cookie?document.cookie.split("; "):[],n={},i=0;i<t.length;i++){var r=t[i].split("="),o=r.slice(1).join("=");'"'===o.charAt(0)&&(o=o.slice(1,-1));try{var s=c(r[0]);if(n[s]=(a.read||a)(o,s)||c(o),e===s)break}catch(e){}}return e?n[e]:n}},remove:function(e,t){n(e,"",s(t,{expires:-1}))},withConverter:e};return o}(function(){}))}(window.PopIn,window),function(r,e){"use strict";var t,n="_ss_pp_id",o="_ss_pp_id",i=/^[\d\w]{32}|\d{13}$/,s="OPT_OUT",a=!1,c="";function d(e){var t=parseInt(Math.floor(Math.random()*Math.pow(16,e))).toString(16);return(""+Math.pow(10,e)+t).slice(-e)}function u(e){return i.test(e)?e:s===e&&e}function h(e){r.Common.Storage.set("local",n,e),function(e){var t,n=location.host.split("."),i=n.length-2;do{if(t="."+n.slice(i).join("."),r.Common.Cookie.set(o,c,{expires:365,domain:t,path:"/"}),r.Common.Cookie.get(o))break}while(0<=--i)}()}h(c=u(r.Common.Cookie.get(o))||u(r.Common.Storage.get("local",n))||(a=!0,[d(8),d(4),d(4),d(3),(t=new Date,t.setMinutes(t.getMinutes()+t.getTimezoneOffset()),""+t.getTime())].join(""))),r.define("Common.Uid",{getUid:function(){return c},setUid:function(e,t){if(u(e)){if(e!==c&&!a){var n=r.Common.Utils.getUserInfo();!function e(t){window.Treasure2?new window.Treasure2({writeKey:"8378/25839e06ce4cc1cab55c1c1f1e49d336d6d1d48f",database:"popin_user_id"}).addRecord("popin_uid_change_log",t):setTimeout(function(){e(t)},1e3)}({previous_id:c,current_id:e,host:location.host,media:t||"",os:n.os,device:r.DEVICE||"",os_version:n.os_version,browser:n.browser,browser_version:n.browser_version,screen:n.screen,viewport:n.viewport,charset:n.charset,language:n.language,color:n.color})}h(c=e),a=!1}}})}(window.PopIn,window),function(e,c){"use strict";e.createClass("Common.NodeBuilder",function(e){this.structures=e},{build:function(){return!1===Array.isArray(this.structures)&&(this.structures=[this.structures]),this.createNodes(this.structures)},createNodes:function(e){for(var t,n,i,r,o=c.createDocumentFragment(),s=0,a=e.length;s<a;s++)"object"==typeof(t=e[s])&&(n=this.createNode(t),i=t.children,!0===Array.isArray(i)&&0<i.length&&(r=this.createNodes(i),n.appendChild(r)),o.appendChild(n));return this._getTopNode(o)},createNode:function(e){var t=c.createElement(e.tagName);return this._setProperty(t,e.property),this._setClass(t,e.classList),t},_getTopNode:function(e){return 1<e.childElementCount||e.children&&1<e.children.length||1<e.childNodes.length?e:e.firstElementChild||e.firstChild},_setProperty:function(e,t){var n;if("object"==typeof t)for(var i in t)"object"==typeof(n=t[i])?this._setProperty(e[i],n):e[i]=n},_setClass:function(e,t){if(t){var n=e.classList;if(!0===Array.isArray(t))for(var i=0,r=t.length;i<r;i++)n.add(t[i]);else n.add(t)}}})}(window.PopIn,document),function(o,s,a,c){"use strict";var d=o.Common.NodeBuilder,u="__popIn_dom_key__",h=[];o.define("Common.Utils",{replaceAll:function(e,t){if(!e||!t)return e;for(var n,i=e,r=0,o=t.length;r<o;r++)for(var s in n=t[r])i=i.replace(new RegExp(s),n[s]);return i},convertQueryStringToObject:function(e){for(var t,n=e.replace(/^\?/,"").split("&"),i={},r=0,o=n.length;r<o;r++)i[(t=n[r].split("="))[0]]=t[1];return i},getRootDomain:function(e){for(var t=e.split("."),n=[],i=t.pop();0<t.length&&"www"!==i&&(n.push(i),!(3<i.length&&0<n.length));i=t.pop());return n.reverse().join(".")},setValueToObjectIfConditionIsMet:function(e,t,n,i){!0===e&&(i[n]=t)},createIframeBodyOuterHTML:function(e){var t=[];return t.push('<body style="margin:0px;padding:0px;background-color: transparent;">',"<script>window.inDapIF = true;<\/script>",e,"</body>"),t.join("")},writeCodeInIframe:function(e){var t=this.createIFrameObject("javascript:false");a.body.appendChild(t.element),t.write(this.createIframeBodyOuterHTML(e))},createIFrameObject:function(e,t){return{element:new d({tagName:"iframe",property:{src:e=e||"about:self",scrolling:"no",frameBorder:0,style:{display:(t=t||{}).display||"block",width:t.width||0,height:t.height||0,margin:t.margin||0,padding:t.padding||0,overflow:t.overflow||"none"}}}).build(),write:function(e){var t=this.element;null!==t.contentDocument?this._writeTextInIframe(t,e):setTimeout(this.write.bind(this,e),o.RETRY_INTERVAL)},_writeTextInIframe:function(e,t){var n=e.contentDocument;n.open(),n.write(t),n.close()}}},DIGEST_CHARS:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!$",digest:function(e){for(var t=0,n="",i=0,r=e.length;i<r;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;for(var o=0;o<6;o++)n+=this.DIGEST_CHARS.charAt(63&t),t>>>=6;return n},shuffle:function(e){for(var t,n,i=e.length;0!==i;)n=Math.floor(Math.random()*i),t=e[--i],e[i]=e[n],e[n]=t;return e},requestByJSONP:function(e,t){void 0===this.requestByJSONP._count&&(this.requestByJSONP._count=0);var n=o.JSONP_REQUEST_CALLBACK+this.requestByJSONP._count;if(void 0!==s[n])return this.requestByJSONP._count++,void this.requestByJSONP.call(this,e,t);s[n]=function(e){"function"==typeof t&&t(e),delete s[n]};var i=new d({tagName:"script",property:{src:e+"&callback="+n,type:"text/javascript",charSet:"UTF-8",async:!0}}),r=a.getElementsByTagName("script")[0];r.parentNode.insertBefore(i.build(),r),this.requestByJSONP._count++},getOS:function(e){switch(!0){case/Android/.test(e):return"Android";case/iPhone|iPad|iPod/.test(e):return"iOS";case/Windows/.test(e):return"Windows";case/Mac OS X/.test(e):return"Mac"}return"other"},_normalizeSemverString:function(e){var t=e.split(/[._]/);return(parseInt(t[0],10)||0)+"."+(parseInt(t[1],10)||0)+"."+(parseInt(t[2],10)||0)},_getVersion:function(e,t){try{return this._normalizeSemverString(e.split(t)[1].trim().split(/[^\w.]/)[0])}catch(e){}return"0.0.0"},getOSVersion:function(e,t){switch(t){case"Android":return this._getVersion(e,"Android");case"iOS":return this._getVersion(e,/OS /);case"Windows":return this._getVersion(e,/Phone/.test(e)?/Windows Phone (?:OS )?/:/Windows NT/);case"Mac":return this._getVersion(e,/Mac OS X /)}return"0.0.0"},getBrowser:function(e){switch(!0){case/CriOS/.test(e):return"Chrome for iOS";case/Edge/.test(e):return"Edge";case/Chrome/.test(e):return"Chrome";case/Firefox/.test(e):return"Firefox";case/Android/.test(e):return"AOSP";case/MSIE|Trident/.test(e):return"IE";case/Safari\//.test(e):return"Safari";case/AppleWebKit/.test(e):return"WebKit";case/Vivaldi/.test(e):return"Vivaldi"}return""},getBrowserVersion:function(e,t){switch(t){case"Chrome for iOS":return this._getVersion(e,"CriOS/");case"Edge":return this._getVersion(e,"Edge/");case"Chrome":return this._getVersion(e,"Chrome/");case"Firefox":return this._getVersion(e,"Firefox/");case"Vivaldi":return this._getVersion(e,"Vivaldi/");case"AOSP":return this._getVersion(e,/Silk/.test(e)?"Silk/":"Version/");case"IE":return/IEMobile/.test(e)?this._getVersion(e,"IEMobile/"):/MSIE/.test(e)?this._getVersion(e,"MSIE "):this._getVersion(e,"rv:");case"Safari":return this._getVersion(e,"Version/");case"Webkit":return this._getVersion(e,"WebKit/")}return""},getScreen:function(){var e=s.screen;try{e=s.parent.screen}catch(e){}return e?[e.width,e.height].join("x"):"-"},getViewPort:function(){var e=a.documentElement,t=e&&e.clientHeight,n=e&&e.clientWidth,i=s.innerHeight,r=s.innerWidth;return(n<r?r:n)+"x"+(t<i?i:t)},getUserInfo:function(){if(this.getUserInfo._chached)return this.getUserInfo._chached;var e=s.navigator,t=e.userAgent,n=this.getOS(t),i=this.getOSVersion(t,n),r=this.getBrowser(t),o=this.getBrowserVersion(t,r);return this.getUserInfo._chached={os:n,os_version:i,browser:r,browser_version:o,screen:this.getScreen(),viewport:this.getViewPort(),user_agent:t,referrer:a.referrer,path:c.pathname,charset:(a.characterSet||a.charset||"-").toLowerCase(),language:e&&(e.language||e.language||e.browserLanguage||"-").toLowerCase(),color:s.screen?s.screen.colorDepth+"-bit":"-",title:a.title,url:c.href.split("#")[0],platform:e.platform,host:c.host}},parseUrl:function(e){var r={};if(0<e.indexOf("?")){var t=e.substring(e.indexOf("?"));e=e.substring(0,e.indexOf("?")),t.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function(e,t,n,i){r[t]=i})}return{url:e,qString:r}},parseUri:function(e){var t=e.match(/^(?:([^:/?#]+):)?(?:\/\/([^/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/);return null===t?null:{scheme:t[1],host:t[2],path:t[3],query:t[4],fragment:t[5]}},convertObjectToParameterString:function(e){var t,n="";for(var i in e)void 0!==(t=e[i])&&(n+=(""===n?"":"&")+i+"="+t);return n},killEvent:function(e){e.preventDefault(),e.stopPropagation()},renderNode:function(e,t,n){switch(n.toLowerCase()){case"beforebegin":t.parentNode.insertBefore(e,t);break;case"afterbegin":t.insertBefore(e,t.firstChild);break;case"beforeend":t.appendChild(e);break;case"afterend":t.parentNode.insertBefore(e,t.nextSibling)}},getSupportedDevice:function(){return void 0!==this.getSupportedDevice._device?this.getSupportedDevice._device:this.getSupportedDevice._device="mobile"===this.getDevice(navigator.userAgent)?"mobile":"pc"},generateBasicLogValue:function(e){e=e||{};var t,n="";for(var i in e)void 0!==(t=e[i])&&(n+=(""===n?"":"|")+encodeURIComponent(i+t));return n},generateR5Value:function(e){e=e||{};var t={};for(var n in e)t[n+"_"]=e[n];return this.generateBasicLogValue(t)},includes:function(e,t){for(var n=0,i=t.length;n<i;n++)if(t[n]===e)return!0;return!1},requestByImageBeacon:function(e,t,n){var i=new Image;"function"==typeof t&&i.addEventListener("load",t,!1),"function"==typeof n&&i.addEventListener("error",n,!1),i.src=e},getPosition:function(e){var t=e.getBoundingClientRect(),n=s.pageXOffset,i=s.pageYOffset;return{top:i+t.top,left:n+t.left,right:n+t.right,bottom:i+t.bottom}},getSize:function(e){return{width:e.offsetWidth,height:e.offsetHeight}},calculateNodeArea:function(e){return e.offsetWidth*e.offsetHeight},getPopInDomData:function(e,t){if(!e)return{};var n=+e[u];if("number"!=typeof n||NaN===n)return null;var i=h[n]||null;return"string"==typeof t?i[t]:i},setPopInDomData:function(e,t,n){if(!e)return null;var i=e[u]||"",r={};return""===i?(i=h.length,e[u]=i):r=h[i=+i]||{},"string"==typeof t?r[t]=n:"[object Object]"===Object.prototype.toString.call(t)&&(r=Object.assign(r,t)),h[i]=r}})}(window.PopIn,window,document,window.location),function(e,n){"use strict";var t=e.Common,i=t.Utils,r=t.NodeBuilder;e.define("Common.CSSManager",{css:"",_cache:[],_node:void 0,add:function(e){"object"==typeof e&&(e=this.convertObjectToCSS(e));var t=i.digest(e),n=this._cache;!1===i.includes(t,n)&&(this.css+=e,n.push(t))},convertObjectToCSS:function(e){return JSON.stringify(e,null,"\n").replace(/,[\n\r]/g,";").replace(/[\n\r]|^{|}$|"/g,"").replace(/:\s?{/g,"{").replace(/};?/g,";}")},render:function(){void 0===this._node?this._node=this._createNode(this.css):this._node.textContent+=this.css,this.css=""},_createNode:function(e){var t=new r({tagName:"style",property:{type:"text/css",rel:"stylesheet",charSet:"UTF-8",textContent:e}}).build();return n.getElementsByTagName("head")[0].appendChild(t),t}})}(window.PopIn,document),function(e){"use strict";(window.PopIn||{}).createClass("Common.Publisher",function(){this._subscribers={}},{on:function(e,t){var n=this._subscribers;return!1===Array.isArray(n[e])&&(n[e]=[]),n[e].push(t),{off:this.off.bind(this,e,t)}},off:function(e,t){var n=this._subscribers[e];if(!1!==Array.isArray(n)){var i=n.indexOf(t);n.splice(i,1)}},trigger:function(e){var t=this._subscribers[e];if(!1!==Array.isArray(t))for(var n,i=[].slice.call(arguments,1),r=0,o=t.length;r<o;r++)"function"==typeof(n=t[r])&&n.apply(null,i)}})}(),function(e,r,t){"use strict";e.inherit("Common.Timer",e.Common.Publisher,function(){var e=this.constructor;if(void 0!==e._instance)return e._instance;this._queue=[],this._isStarted=!1,this._length=0,this._updateCount=0,this._isInitialised=!1,e._instance=this},{UPDATE_INTERVAL:50,set:function(e,t,n){n=n||this._length;var i=Math.round(t/this.UPDATE_INTERVAL);return this._length=this._queue.push({key:n,handler:e,timing:1<=i?i:1}),!1===this._isInitialised&&(r.addEventListener("visibilitychange",this._toggleActive.bind(this),!1),this._isInitialised=!0),this._start(),n},remove:function(e){for(var t=this._queue,n=0,i=t.length;n<i;n++)if(t[n].key===e)return t.splice(n,1),this._length--,!0;return!1},_update:function(){var e=this._queue;if(0===e.length)return this._stop(),void(this._updateCount=0);this._updateCount++;for(var t,n=this._updateCount,i=0,r=e.length;i<r;i++)n%(t=e[i]).timing==0&&t.handler();this.trigger("update",this)},_start:function(){if(!0===this._isStarted)return!1;this._isStarted=!0,this._timer=setInterval(this._update.bind(this),this.UPDATE_INTERVAL)},_stop:function(){if(!1===this._isStarted)return!1;clearInterval(this._timer),this._isStarted=!1},_toggleActive:function(){!0===t.hidden?this._stop():this._start()}})}(window.PopIn,window,document),function(e,n){"use strict";e.define("Common.NodeObserver",{DEFAULT_UPDATE_INTERVAL:100,CLASS_NAME_VISIBLE:"visible",targets:[],_isStarted:!1,_timerKey:null,_subscriber:void 0,_timer:new e.Common.Timer,addTarget:function(e){this.targets.push({node:e.node,onInView:e.onInView})},addTargets:function(e,t){for(var n=0,i=e.length;n<i;n++)this.addTarget({node:e[n],onInView:t})},start:function(){var e=this._timer;!1===this._isStarted&&(this._subscriber=e.on("update",this._onUpdate.bind(this)),this._isStarted=!0),null===this._timerKey&&(this._timerKey=e.set(this._update.bind(this),this.DEFAULT_UPDATE_INTERVAL))},stop:function(){null!==this._timerKey&&(this._timer.remove(this._timerKey),this._timerKey=null)},_update:function(){for(var e,t,n=this.targets,i=0,r=n.length;i<r;i++)t=(e=n[i]).node,!0===this._isVisible(t)&&(t.classList.add(this.CLASS_NAME_VISIBLE),n.splice(i,1),"function"==typeof e.onInView&&e.onInView(t),i--,r--)},_onUpdate:function(){0===this.targets.length&&(this._subscriber.off(),this.stop())},_isVisible:function(e){var t=e.getBoundingClientRect().top;return 0<t&&0<n.innerHeight-t}})}(window.PopIn,window,document),function(r,e,i,o){"use strict";var s=r.Common,a=s.Utils;r.PROTOCOL;r.inherit("Common.Loader",s.Publisher,function(e){e=e||{},this.target=e.target||o.href,this.apiUrl=e.apiUrl||this.INITIAL_API_URL,0===this.apiUrl.indexOf("http:")&&(this.apiUrl=this.apiUrl.replace("http:","https:")),this.apiUrlAdd=e.apiUrlAdd||"",this.device=e.device||r.DEVICE,this.media=e.media,this.agency=e.agency,this.topn=e.topn||0,this.ad=e.ad||0,this.urlReplace=e.urlReplace,this.useForSzAdLtrRatio=e.useForSzAdLtrRatio,this.infiniteLoadPage=e.infiniteLoadPage,this.useSzAdLtrChannelIdPrefix=e.useSzAdLtrChannelIdPrefix,this.pathnum=e.pathnum,this.needRecommendInformation=e.needRecommendInformation||!1,this.needUserTdInfo=e.needUserTdInfo||!1,this.positionAndStyleObj=null,this.templates=e.templates||[],this.apiHost="",this.country="",this.referrer="",this.requestUrl="",this.popInUserId="",this.userInfo,this.userTdInfo},{INITIAL_API_URL:"https://discoveryplus.popin.cc/popin_discovery/recommend?url=%target",GET_UID_PAGE_URL:"https://api.popin.cc/retarget/uid.html?ac=getuid",SESSION_STORAGE_KEY_UID:"_ss_pp_id",REFFERER_DICTIONARY:{portal_google:/news\.google\.co/,search_yahoo:/search\.yahoo\.co/,sns_facebook:/facebook\.co/,sns_twitter:/twitter\.co|t\.co$/,portal_yahoo:/yahoo\.co/,portal_goo:/goo\.ne/,portal_infoseek:/infoseek\.co/,portal_msn:/msn\.com|www\.msn\.cn/,portal_excite:/excite\.co\.jp/,portal_livedoor:/livedoor\.com/,search_naver:/search\.naver\.com/,sns_naver:/naver\.com|naver\.jp/,sns_hatena:/hatena\.ne\.jp/,portal_aol:/aol\.jp/,search_google:/google\.co/,search_bing:/www\.bing\.com/,portal_biglobe:/www\.biglobe\.ne\.jp/,app_smartnews:/www\.smartnews\.be|www\.smartnews\.com/,app_gunosy:/gunosy\.com/,app_newspicks:/newspicks\.com/,app_antenna:/antenna\.jp/,paid_outbrain:/paid\.outbrain\.com/,paid_yahoo:/trc\.taboola\.com/,paid_logly:/dsp\.logly\.co\.jp/,search_baidu:/www\.baidu\.com/,"search_m-sm":/m\.sm\.cn/,search_so:/www\.so\.com/,search_sogou:/www\.sogou\.com/,"portal_news-baidu":/news\.baidu\.com/,portal_sina:/www\.sina\.com\.cn/,portal_sohu:/www\.sohu\.com/,portal_qq:/www\.qq\.com/,portal_163:/www\.163\.com/,"portal_hao-360":/hao\.360\.cn/,portal_china:/www\.china\.com/,"sns_wechat)":/www\.wechat\.com/,"sns_tieba-baidu":/tieba\.baidu\.com/,sns_weibo:/www\.weibo\.com/,sns_xiaohongshu:/www\.xiaohongshu\.com/},load:function(){var e=this.apiUrl;this.target=this._formatUrl(this.target),this.positionAndStyleObj=this.getPositionAndStyle();var t=e.match(/(jp|tw|kr).popin.cc/);if(this.country=Array.isArray(t)?t[1]:"",this.apiHost=a.parseUri(e).host.replace("discoveryplus.","jp."),this.userInfo=a.getUserInfo(),this.userTdInfo=!0===this.needUserTdInfo?this._generateUserTdInfo():"",this.popInUserId=r.Common.Uid.getUid(),this.referrer=this._getReferrer(),this.setSzAdLtrByBatch(),!0===this.needRecommendInformation?a.requestByJSONP(this._generateRequestUrl(this.target),this._onResponse.bind(this)):this.trigger("response",this),0<this.templates.length){var n=((e=this.apiUrl+"&"+this.apiUrlAdd).match(/[\?&]rid=([^&]+)/)||["",""])[1],i=(e.match(/[\?&]alg=([^&]+)/)||["",""])[1];s.rid=n,s.alg=i}},_onResponse:function(e){this._setUid(e.cookie),this.responseData=e,this.trigger("response",this)},_generateRequestUrl:function(e){var t=this.apiUrl.replace(/%target/g,encodeURIComponent(e)),n=navigator.userAgent,i={media:this.media,agency:this.agency,device:this.device,extra:a.getOS(n).toLowerCase(),topn:this.topn,ad:this.ad||void 0,pathnum:this.pathnum,uid:r.Common.Uid.getUid(),info:this.userTdInfo||void 0};return t+"&"+(a.convertObjectToParameterString(i)+this.apiUrlAdd.replace(/\?/,"&"))},_generateUserTdInfo:function(){if(void 0!==this._generateUserTdInfo.userTdInfo)return this._generateUserTdInfo.userTdInfo;var e=a.getUserInfo(),t={};for(var n in e)t["user_td_"+n]="title"===n?encodeURIComponent(e[n]):e[n];return t.user_device=this.device,t.user_time=s.Global.startTime,t.fruit_box_position=this.positionAndStyleObj.boxPosition,t.fruit_style=this.positionAndStyleObj.adStyleMonitor,this._generateUserTdInfo.userTdInfo=btoa(unescape(encodeURIComponent(JSON.stringify(t))))},_getReferrer:function(){if(""===i.referrer)return"organic";var e=this.REFFERER_DICTIONARY,t=a.parseUri(i.referrer).host||"";for(var n in e)if(!0===e[n].test(t))return n;return-1<t.indexOf(o.host)?"site":-1<o.href.indexOf("utm_medium=logly")?"paid_logly":"other"},_formatUrl:function(e){return a.replaceAll(e,this.urlReplace)},_setUid:function(e){e&&e.uid&&r.Common.Uid.setUid(e.uid,this.media)},getPositionAndStyle:function(){var e="",t="",n=s.Storage.get("local","_popIn_box_position_style_key_")||"";return n&&(n=JSON.parse(n))&&0<n.length&&(e=n[0].boxPosition||"",t=n[0].adStyleMonitor||""),{boxPosition:e,adStyleMonitor:t}},setSzAdLtrByBatch:function(){"ignore"!==this.useForSzAdLtrRatio&&-1===this.apiUrl.indexOf("&alg=ltr")&&-1===this.apiUrlAdd.indexOf("&alg=ltr")&&("number"==typeof this.useForSzAdLtrRatio?Math.random()<=this.useForSzAdLtrRatio?(this.apiUrl=this.apiUrl+"&alg=ltr",this.appenedAdLtrPrefix()):this.infiniteLoadPage&&this.removeWthSzPrefix():"tw.popin.cc"!=this.apiHost&&"jp.popin.cc"!=this.apiHost||(this.apiUrl=this.apiUrl+"&alg=ltr"))},appenedAdLtrPrefix:function(){for(var e=void 0===this.useSzAdLtrChannelIdPrefix?"":this.useSzAdLtrChannelIdPrefix,t=0;t<this.templates.length;t++){var n=this.templates[t];n.channelId&&0!==n.channelId.indexOf("with_sz_")&&(n.channelId=e+n.channelId)}},removeWthSzPrefix:function(){for(var e=0;e<this.templates.length;e++){var t=this.templates[e];t.channelId&&0===t.channelId.indexOf("with_sz_")&&(t.channelId=(t.channelId.match(/with_sz_(\S*)/)||[t.channelId,t.channelId])[1])}}})}(window.PopIn,window,document,location),function(e){"use strict";(window.PopIn||{}).createClass("Common.Message",function(e){this.country=e||"",this.dictionary=this.DICTIONARY[e.toUpperCase()]||this.DICTIONARY.JP},{DICTIONARY:{JP:{video_button_detail:"詳しくはこちら",video_button_calendar:"カレンダーに登録",video_counter:"再生回数 {{value}}回",video_end_replay:"動画をリプレイ",video_end_detail:"詳しくはこちら",read_debug_container:"本文領域",read_debug_info_view:"本文表示率:{{value}}%",read_debug_info_read:"読了率:{{value}}%",read_debug_info_time:"読む時間:{{value}}秒"},TW:{video_button_detail:"深入了解",video_button_calendar:"カレンダーに登録",video_counter:"觀看次數 {{value}}次",video_end_replay:"再看一次",video_end_detail:"瞭解詳情",read_debug_container:"正文",read_debug_info_view:"正文顯示率:{{value}}%",read_debug_info_read:"正文閱讀率:{{value}}%",read_debug_info_time:"正文閱讀時間:{{value}}秒"}},get:function(e){return this.dictionary[e]}})}(),function(e,t){if(void 0===t[e]){t[e]=function(){t[e].clients.push(this),this._init=[Array.prototype.slice.call(arguments)]},t[e].clients=[];for(var n=function(e){return function(){return this["_"+e]=this["_"+e]||[],this["_"+e].push(Array.prototype.slice.call(arguments)),this}},i=["getTrackValues","addRecord","set","trackEvent","trackPageview","trackClicks","ready"],r=0;r<i.length;r++){var o=i[r];t[e].prototype[o]=n(o)}var s=document.createElement("script");s.type="text/javascript",s.async=!0,s.src=window.PopIn.PROTOCOL+"//api.popin.cc/td_js_sdk_171.js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(s,a)}}("Treasure2",window),function(o,i){"use strict";var e,s=o.Common.Utils,t=o.PROTOCOL,n={NORMAL_MODE:"normal",OTHER_MODE:"other",NORMAL_MODE_REQUEST_URL:t+"//rlog.popin.cc/s.gif",OTHER_MODE_REQUEST_URL:t+"//r.popin.cc/log.gif",send:function(e,t,n,i){e=e||this.NORMAL_MODE;var r=s.convertObjectToParameterString(t),o=this._getRequestPrefix(e);return s.requestByImageBeacon(o+"?"+r,n,i),this},_getRequestPrefix:function(e){switch(e){case this.NORMAL_MODE:return this.NORMAL_MODE_REQUEST_URL;case this.OTHER_MODE:return this.OTHER_MODE_REQUEST_URL}}},r={REQUEST_URL:t+"//inrecsys.popin.cc/PopinService/Logs/",send:function(e,t){t=t||{};var n=JSON.stringify(t),i=btoa(unescape(encodeURIComponent(n)));s.requestByImageBeacon(this.REQUEST_URL+e+"?data="+i)}},a=function(e){this.writeKey=e,this._loggers={}};(e=a.prototype).open=function(e,t){var n=new i.Treasure2({writeKey:this.writeKey,database:e});n.set("$global","td_global_id","td_global_id"),this._loggers[e]=n,"function"==typeof t&&n.ready(t)},e.ready=function(e,t){this._loggers[e].ready(t)},e.getTrackValues=function(e){return this._loggers[e].getTrackValues()},e.send=function(e,t,n,i,r){return"popin_media"===e&&"discoverylogs"===t?this.sendUts(e,t,n):(this.sendTd(e,t,n,i,r),"popin_ads"===e&&"adlogs"===t&&this.sendUts(e,t,n)),this},e.sendTd=function(e,t,n,i,r){return this._loggers[e].addRecord(t,n,function(){"function"==typeof i&&i()},function(){"function"==typeof r&&r()}),this},e.sendUts=function(e,t,n){var i=s.getUserInfo();n.td_os=i.os,n.td_os_version=i.os_version,n.td_browser=i.browser,n.td_browser_version=i.browser_version,delete n.td_ip;var r=JSON.stringify(n),o=["https://log.popin.cc/log","/"+e,"/"+t,"?data="+btoa(unescape(encodeURIComponent(r))),"&t="+(new Date).getTime()].join("");(new Image).src=o};var c,d=function(){var e=this.constructor;if(void 0!==e._instance)return e._instance;this.isReady=!1,this.basic=n;var t=new a(this.TD_WRITE_KEY);t.open(this.DB_NAME_DISCOVERY_LOG),t.open(this.DB_NAME_AD,this._onReadyTreasure.bind(this,t)),this.treasure=t,this.inrecsys=r,this._sendLog={basic:this._sendBasicLog.bind(this),treasure:this._sendTreasureLog.bind(this),inrecsys:this._sendInrecsysLog.bind(this)},i.addEventListener("touchstart",this._recordUserInteraction,!1),i.addEventListener("click",this._recordUserInteraction,!1),i.addEventListener("mousedown",this._recordUserInteraction,!1),e._alreadyOutputData=[],e._interactionNumber=0,e._lastEvent=!1,e._instance=this};(c=d.prototype).TD_WRITE_KEY="8378/25839e06ce4cc1cab55c1c1f1e49d336d6d1d48f",c.DB_NAME_DISCOVERY_LOG="popin_media",c.DB_NAME_AD="popin_ads",c.send=function(e,t){t=t||{};var n=this._sendLog[e];"function"==typeof n&&!0===this._isValid(e,t)&&n(t)},c.getTrackValues=function(){return this.trackValues||null},c.setTzValue=function(e,t){if(e&&"normal"!==e)return t;var n={r1:/.*/,type:/(pc|mobile)_viewall/},i=!1;for(var r in n)if(t[r]&&n[r].test(t[r])){i=!0;break}return i||(t.tz=o.REQUEST_COUNTRY),t},c.ready=function(e){!0===this.isReady?e():this.treasure.ready(this.DB_NAME_AD,e)},c._onReadyTreasure=function(e){this.isReady=!0,this.trackValues=e.getTrackValues(this.DB_NAME_AD)},c._sendBasicLog=function(e){var t=(e=e||{}).data||{};t.t=Date.now(),t=this.setTzValue(e.mode,t),this.basic.send(e.mode,t,e.onComplete,e.onError)},c._sendTreasureLog=function(e){var t=(e=e||{}).data||{};t.popin_version=o.VERSION,t.interaction_number=this.constructor._interactionNumber;var n=this._lastEvent;if(n){if(n.touches){var i=n.touches[0];t.interaction_touchx=Math.round(i.pageX),t.interaction_touchy=Math.round(i.pageY)}"mousedown"===n.type&&(t.interaction_mousex=Math.round(n.pageX),t.interaction_mousey=Math.round(n.pageY))}this.treasure.send(e.db,e.table,t,e.onComplete,e.onError)},c._sendInrecsysLog=function(e){var t=(e=e||{}).data||{};t.now=Date.now(),t.popin_version=o.VERSION,this.inrecsys.send(e.api,t)},c._recordUserInteraction=function(e){var t=this.constructor;t._interactionNumber++,t._lastEvent=e},c._isValid=function(e,t){var n=t.uniqueId;if("string"==typeof n){var i=e+"|"+n,r=this.constructor._alreadyOutputData;if(!0===s.includes(i,r))return!1;r.push(i)}return!0};var u=new d;u.ready(function(){o.define("Common.Logger",u)})}(window.PopIn,window),function(e,t){"use strict";e.define("Common.Global",{startTime:Date.now(),expectedAndRenderAds:{}})}(window.PopIn,window),function(t,e,n){"use strict";t.createClass("Common.Messenger",function(e){e=e||{},this.url=e.url,this._iframeNode},{setup:function(){var e=t.Common.Utils.createIFrameObject(this.url).element;n.body.appendChild(e),this._iframeNode=e},send:function(e){this._iframeNode.contentWindow.postMessage(JSON.stringify(e),"*")}})}(window.PopIn,window,document);